!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.KCS=e():t.KCS=e()}(this,function(){return function(t){function e(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,o){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e,r){t.exports=r(11)},function(t,e){e.arrayToObject=function(t){for(var e={},r=0,o=t.length;r<o;++r)void 0!==t[r]&&(e[r]=t[r]);return e},e.merge=function(t,r){if(!r)return t;if("object"!=typeof r)return t.push(r),t;if("object"!=typeof t)return t=[t].concat(r);Array.isArray(t)&&!Array.isArray(r)&&(t=e.arrayToObject(t));for(var o=Object.keys(r),n=0,i=o.length;n<i;++n){var a=o[n],u=r[a];t[a]?t[a]=e.merge(t[a],u):t[a]=u}return t},e.decode=function(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t}},e.compact=function(t,r){if("object"!=typeof t||null===t)return t;r=r||[];var o=r.indexOf(t);if(-1!==o)return r[o];if(r.push(t),Array.isArray(t)){for(var n=[],i=0,a=t.length;i<a;++i)void 0!==t[i]&&n.push(t[i]);return n}for(var u=Object.keys(t),i=0,s=u.length;i<s;++i){var c=u[i];t[c]=e.compact(t[c],r)}return t},e.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},e.isBuffer=function(t){return null!==t&&void 0!==t&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}},function(t,e,r){"use strict";function o(){var t={},e=window.location.search.substring(1);if(e.length>0)for(var r=e.split("&"),o=0;o<r.length;o++){var n=r[o],i=n.split("=");2==i.length&&(t[i[0]]=i[1])}return t}function n(){createjs.Ticker.timingMode=createjs.Ticker.TIMEOUT,createjs.Ticker.setFPS(60);var t={antialias:!0,backgroundColor:0};c=new PIXI.Application(d.default.width,d.default.height,t),document.body.appendChild(c.view),c.stage.scale.set(1.5),p=new f.MainView,c.stage.addChild(p),p.initialize(function(){i()})}function i(){var t=o();l=t.dmmuser_id,l?a():p.showError()}function a(){(new h.GetWorldInfoAPI).load(l,function(t){if(null==t)return void p.showError();console.log(t),1==t.api_result?p.showContent(t.api_data.api_world_info,u):-2==t.api_result?p.showLimit():p.showError()})}function u(t){if(null==t)return void p.showError();if(t.api_entry>1)return void p.showLimit();var e=new PIXI.Graphics;e.beginFill(0,.1),e.drawRect(0,0,p.width,p.height),e.endFill(),e.interactive=!0,p.addChild(e),(new _.RegisterAPI).load(parseInt(l),t.api_id,function(t){if(t)try{var r=o(),n="http://"+r.osapi_root;window.parent.postMessage("r",n),window.addEventListener("message",s)}catch(t){p.showError()}else p.showError(),e.alpha=0})}function s(t){window.removeEventListener("message",s);var e=t.data,r=o(),n="http://"+r.osapi_root;t.origin==n&&"error"!=e||p.showError()}Object.defineProperty(e,"__esModule",{value:!0});var c,l,p,d=r(3),f=r(4),h=r(10),_=r(14),v={init:n};e.default=v},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){}return Object.defineProperty(t,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t._width=1200,t._height=720,t}();e.default=o},function(t,e,r){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=r(5),i=r(9),a=function(t){function e(){var e=t.call(this)||this;return e.IMG_BG="resources/worldselect/bg.jpg",e.IMG_TITLE="resources/worldselect/title20_select.png",e.IMG_GEAR_ICON="resources/worldselect/title20_icon.png",e.IMG_ERROR="resources/worldselect/error.png",e.IMG_LIMIT="resources/worldselect/limit.png",e._content=new PIXI.Container,e.addChild(e._content),e}return o(e,t),e.prototype.initialize=function(t){var e=this;if(null==this._errorLayer){var r=new PIXI.loaders.Loader;r.add(this.IMG_BG),r.add(this.IMG_TITLE),r.add(this.IMG_GEAR_ICON),r.load(function(){e.texture=PIXI.Texture.fromFrame(e.IMG_BG),t&&t()})}},e.prototype.showContent=function(t,e){var r=this;if(null==this._errorLayer){this._content.removeChildren(),this._content.alpha=0;var o=PIXI.Sprite.fromFrame(this.IMG_TITLE);o.position.set(33,4),this._content.addChild(o),this._gear=new i.Gear,this._gear.position.set(276,18),this._gear.initialize(PIXI.Texture.fromFrame(this.IMG_GEAR_ICON)),this._content.addChild(this._gear);var a=new n.WorldButtonLayer(e);this._content.addChild(a),a.initialize(t,function(){r._gear.activate(),createjs.Tween.get(r._content).to({alpha:1},300)})}},e.prototype.showError=function(){if(null==this._errorLayer){this._errorLayer=new PIXI.Graphics,this.texture&&(this._errorLayer.beginFill(0,.3),this._errorLayer.drawRect(0,0,this.width,this.height),this._errorLayer.endFill()),this._errorLayer.interactive=!0,this.addChild(this._errorLayer),this._gear.deactivate();var t=PIXI.Sprite.fromImage(this.IMG_ERROR);this._errorLayer.addChild(t)}},e.prototype.showLimit=function(){if(null==this._errorLayer){this._errorLayer=new PIXI.Graphics,this.texture&&(this._errorLayer.beginFill(0,.3),this._errorLayer.drawRect(0,0,this.width,this.height),this._errorLayer.endFill()),this._errorLayer.interactive=!0,this.addChild(this._errorLayer),this._gear.deactivate();var t=PIXI.Sprite.fromImage(this.IMG_LIMIT);this._errorLayer.addChild(t)}},e}(PIXI.Sprite);e.MainView=a},function(t,e,r){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=r(6),i=function(t){function e(e){var r=t.call(this)||this;r._onMouseOver=function(t){r._button_on.x=t.x,r._button_on.y=t.y,r._button_on.visible=!0},r._onMouseOut=function(t){r._button_on.x==t.x&&r._button_on.y==t.y&&(r._button_on.visible=!1)},r._buttons=[];for(var o=0;o<20;o++){var i=new n.WorldButton(r._onMouseOver,r._onMouseOut,e);i.x=o%2==0?20:405,i.y=38+44*Math.floor(o/2),r.addChild(i),r._buttons.push(i)}return r._button_on=new a,r._button_on.visible=!1,r.addChild(r._button_on),r}return o(e,t),e.prototype.initialize=function(t,e){var r=this;if(e=e||function(){},null==t)return void e();this._preLoad(t,function(){r._button_on.initialize();for(var o={},n=0,i=t;n<i.length;n++){var a=i[n];o[a.api_id]=a}for(var u=0;u<r._buttons.length;u++){var a=o[u+1];r._buttons[u].initialize(a)}e()})},e.prototype._preLoad=function(t,e){var r=new PIXI.loaders.Loader;r.add("world_on","resources/worldselect/btn_chinjyufu_on.png"),r.add("gauge_bg","resources/worldselect/gauge20_gray.png"),r.add("gauge","resources/worldselect/gauge20.png");for(var o=0;o<this._buttons.length;o++){var n=o<t.length?t[o]:null;null!=n&&(n.api_entry>=1?r.add("world"+(o+1),"resources/worldselect/btn_chinjyufu"+(o+1)+".png"):r.add("world"+(o+1),"resources/worldselect/btn_chinjyufu"+(o+1)+"_off.png"))}r.load(e)},e}(PIXI.Container);e.WorldButtonLayer=i;var a=function(t){function e(){var e=t.call(this)||this;return e._img=new PIXI.Sprite,e._img.position.set(-19,-19),e.addChild(e._img),e}return o(e,t),e.prototype.initialize=function(){this._img.texture=PIXI.Texture.fromFrame("world_on")},e}(PIXI.Container)},function(t,e,r){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=r(7),i=r(8),a=function(t){function e(e,r,o){var n=t.call(this)||this;return n._onMouseOver=function(){n._cb_onMouseOver(n)},n._onMouseOut=function(){n._cb_onMouseOut(n)},n._onClick=function(){n._cb_onClick(n._info)},n._cb_onMouseOver=e,n._cb_onMouseOut=r,n._cb_onClick=o,n._gauge=new u,n._gauge.position.set(189,20),n.addChild(n._gauge),n}return o(e,t),e.prototype.initialize=function(t){if(this._info=t,null==t)return void(this.visible=!1);var e=t.api_id;this.texture=PIXI.Texture.fromFrame("world"+e),this.visible=!0,this._info.api_entry>=1?(this.interactive=!0,this.buttonMode=!0,this.on(n.EventType.MOUSEOVER,this._onMouseOver),this.on(n.EventType.MOUSEOUT,this._onMouseOut),this.on(n.EventType.CLICK,this._onClick)):(this.interactive=!1,this.buttonMode=!1);var r=t.api_rate;this._gauge.initialize(r)},e}(PIXI.Sprite);e.WorldButton=a;var u=function(t){function e(){var e=t.call(this)||this;return e._bg=new PIXI.Sprite,e._bg.position.set(1,1),e.addChild(e._bg),e._bar=new PIXI.Graphics,e.addChild(e._bar),e._frame=new PIXI.Sprite,e._frame.position.set(-6,-13),e.addChild(e._frame),e}return o(e,t),e.prototype.initialize=function(t){this._bg.texture=PIXI.Texture.fromFrame("gauge_bg"),this._frame.texture=PIXI.Texture.fromFrame("gauge"),t=Math.max(0,t),t=Math.min(1,t);var e=i.MathUtil.getColor(1-t),r=168*t;this._bar.beginFill(e),this._bar.drawRect(0,0,r,8),this._bar.endFill()},e}(PIXI.Container)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){return{touch:void 0!==document.ontouchstart,pointer:window.PointerEvent}}();e.pointer={down:o.pointer?"pointerdown":o.touch?"touchstart":"mousedown",move:o.pointer?"pointermove":o.touch?"touchmove":"mousemove",up:o.pointer?"pointerup":o.touch?"touchend":"mouseup",over:o.pointer?"pointerover":"mouseover",out:o.pointer?"pointerout":"mouseout"};!function(t){t.CLICK=e.pointer.up,t.MOUSEOVER=e.pointer.over,t.MOUSEOUT=e.pointer.out,t.MOUSEDOWN=e.pointer.down,t.MOUSEUP=e.pointer.up,t.MOUSEMOVE=e.pointer.move}(e.EventType||(e.EventType={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});!function(t){function e(t,e){var r=t>=0?"":"-";t=Math.abs(t);for(var o=t>0?Math.floor(Math.log(t)*Math.LOG10E+1):1,n="",i=0,a=e-o;i<a;i++)n+="0";return r+n+t}function r(e){var r=Math.floor(e/36e5),o=Math.floor(e%864e5/6e4)%60,n=Math.floor(e%864e5/1e3)%60%60;return t.zeroPadding(r,2)+":"+t.zeroPadding(o,2)+":"+t.zeroPadding(n,2)}function o(t){if(t<0||t>1)throw Error();var e,r=255,o=255;return t<1/3?(e=3*t,o=Math.round(0+128*e)):t<1/3*2?(e=3*(t-1/3),o=Math.round(128+3*(t-1/3)*128)):(e=3*(t-1/3*2),r=Math.round(255-255*e)),(r<<16)+(o<<8)}t.zeroPadding=e,t.timeToString=r,t.getColor=o}(e.MathUtil||(e.MathUtil={}))},function(t,e,r){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){var e=t.call(this)||this;return e.anchor.set(.5),e}return o(e,t),e.prototype.initialize=function(t){this.texture=t},e.prototype.activate=function(){null==this._t&&(this._t=createjs.Tween.get(this,{loop:!0}).to({rotation:2*Math.PI},3e3))},e.prototype.deactivate=function(){null!=this._t&&(this._t.setPaused(!0),this._t=null)},e.prototype.dispose=function(){this.deactivate()},e}(PIXI.Sprite);e.Gear=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),n=function(){function t(){}return t.prototype.load=function(t,e){var r={api_verno:1,api_dmmuser_id:t};axios.post("/kcsapi/api_world/get_worldinfo",o.stringify(r)).then(function(t){var r=t.data.replace(/[\s\S]*svdata=/,""),o=JSON.parse(r);e&&e(o)}).catch(function(t){e&&e(null)})},t}();e.GetWorldInfoAPI=n},function(t,e,r){var o=r(12),n=r(13);t.exports={stringify:o,parse:n}},function(t,e,r){var o=r(1),n={delimiter:"&"};n.stringify=function(t,e){if(o.isBuffer(t)?t=t.toString():t instanceof Date?t=t.toISOString():null===t&&(t=""),"string"==typeof t||"number"==typeof t||"boolean"==typeof t)return[encodeURIComponent(e)+"="+encodeURIComponent(t)];var r=[];if(void 0===t)return r;for(var i=Object.keys(t),a=0,u=i.length;a<u;++a){var s=i[a];r=r.concat(n.stringify(t[s],e+"["+s+"]"))}return r},t.exports=function(t,e){e=e||{};for(var r=void 0===e.delimiter?n.delimiter:e.delimiter,o=[],i=Object.keys(t),a=0,u=i.length;a<u;++a){var s=i[a];o=o.concat(n.stringify(t[s],s))}return o.join(r)}},function(t,e,r){var o=r(1),n={delimiter:"&",depth:5,arrayLimit:20,parameterLimit:1e3};n.parseValues=function(t,e){for(var r={},n=t.split(e.delimiter,e.parameterLimit===1/0?void 0:e.parameterLimit),i=0,a=n.length;i<a;++i){var u=n[i],s=-1===u.indexOf("]=")?u.indexOf("="):u.indexOf("]=")+1;if(-1===s)r[o.decode(u)]="";else{var c=o.decode(u.slice(0,s)),l=o.decode(u.slice(s+1));r.hasOwnProperty(c)?r[c]=[].concat(r[c]).concat(l):r[c]=l}}return r},n.parseObject=function(t,e,r){if(!t.length)return e;var o=t.shift(),i={};if("[]"===o)i=[],i=i.concat(n.parseObject(t,e,r));else{var a="["===o[0]&&"]"===o[o.length-1]?o.slice(1,o.length-1):o,u=parseInt(a,10),s=""+u;!isNaN(u)&&o!==a&&s===a&&u<=r.arrayLimit?(i=[],i[u]=n.parseObject(t,e,r)):i[a]=n.parseObject(t,e,r)}return i},n.parseKeys=function(t,e,r){if(t){var o=/^([^\[\]]*)/,i=/(\[[^\[\]]*\])/g,a=o.exec(t);if(!Object.prototype.hasOwnProperty(a[1])){var u=[];a[1]&&u.push(a[1]);for(var s=0;null!==(a=i.exec(t))&&s<r.depth;)++s,Object.prototype.hasOwnProperty(a[1].replace(/\[|\]/g,""))||u.push(a[1]);return a&&u.push("["+t.slice(a.index)+"]"),n.parseObject(u,e,r)}}},t.exports=function(t,e){if(""===t||null===t||void 0===t)return{};e=e||{},e.delimiter="string"==typeof e.delimiter||o.isRegExp(e.delimiter)?e.delimiter:n.delimiter,e.depth="number"==typeof e.depth?e.depth:n.depth,e.arrayLimit="number"==typeof e.arrayLimit?e.arrayLimit:n.arrayLimit,e.parameterLimit="number"==typeof e.parameterLimit?e.parameterLimit:n.parameterLimit;for(var r="string"==typeof t?n.parseValues(t,e):t,i={},a=Object.keys(r),u=0,s=a.length;u<s;++u){var c=a[u],l=n.parseKeys(c,r[c],e);i=o.merge(i,l)}return o.compact(i)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),n=function(){function t(){}return t.prototype.load=function(t,e,r){var n={api_verno:1,api_dmmuser_id:t,api_world_id:e,api_register_id:this._createKey(t,e)};axios.post("/kcsapi/api_world/register",o.stringify(n)).then(function(t){var e=t.data.replace(/[\s\S]*svdata=/,""),o=JSON.parse(e);r&&r(1==o.api_result)}).catch(function(t){r&&r(!1)})},t.prototype._createKey=function(t,e){var r=new Date,o=t,n=[-1,2080,7711,9335,9155,8953,8745,2634,2362,8260,2497,1136,7329,9310,8117,9313,6382,3047,6929,8867,2921][e],i=1e4*r.getFullYear()+100*(r.getMonth()+1)+r.getDate(),a=r.getHours()+1,u=Math.floor(9e3*Math.random())+1e3,s=Math.floor(9e3*Math.random())+1e3,c=99999999-i,l=c-o,p=l*a,d=p*n;return u.toString()+d.toString()+s.toString()},t}();e.RegisterAPI=n}]).default});